<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="/main.css" rel="stylesheet">
    <link href="/navbar.css" rel="stylesheet">

</head>
<body>
<div th:replace="~{ Normal/nav.html :: navbar }"></div>

<div>
    <p>フルネームで検索する場合、苗字と名前の間に空白を入れてください</p>
    <div style="display: flex ; flex-wrap:wrap">
        <label>
            <input id="searchInput" placeholder="選手検索">
        </label>
        <button class="search-button">検索</button>
    </div>
</div>

<div class="player-list">
    <div class="box" th:if="${players != null}" th:each="player : ${players}">
        <a th:href="@{/playerInfo/{backNumber}(backNumber=${player.backNumber})}">
            <img th:src="${player.src}" alt="player's image">
        </a>
        <div>
            <h4 th:text="${player.name}"></h4>
            <p th:text="${player.backNumber}"></p>
            <p>追加した人：<span th:text="${player.who}"></span></p>
        </div>
    </div>
    <div th:if="${players == null}">
        <p>選手情報がありません</p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>
    $('.search-button').on('click', function () {
        let keyword = $('#searchInput').val()

        fetch('/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({playerName: keyword})
        })
            .then(res => {
                if (!res.ok) {
                    console.log(res);
                    throw new Error('Server Error');
                }
                return res.json()
            })
            .then(data => {
                renderPlayerList(data);
            })
            .catch(function (error) {
                alert('サーバエラーが生じました、後でもう一度試してください');
            })
    })

    function renderPlayerList(players) {
        let html = '';

        if (players.length === 0) {
            html += '<div>選手情報がありません</div>';
        } else {
            players.forEach(function (player) {
                html += `
                <div class="box">
                    <a href="/playerInfo/${player.backNumber}">
                        <img src="${player.src}" alt="player's image">
                    </a>
                    <div>
                        <h4>${player.name}</h4>
                        <p>${player.backNumber}</p>
                        <p>追加した人：<span>${player.who}</span></p>
                    </div>
                </div>
            `;
            });
        }

        // player-list 내부 내용만 교체
        $('.player-list').html(html);
    }

</script>

</body>
</html>
